# FastTOTP - WordPress 快速安全登录插件

[**<span style="color: #0052d9">English</span>**](README.md) | [**<span style="color: #0052d9">中文</span>**](README-zh.md)

## 插件介绍

FastTOTP 是一个为 WordPress 网站提供极简主义无密码登录体验的插件。它允许用户通过扫描二维码并使用 FastTOTP 移动应用进行身份验证，实现快速、安全的登录流程。

- **无需注册账户**：不需要创建额外的用户账户
- **无需记住密码**：通过手机应用扫描登录，彻底告别密码
- **增强安全性**：采用 TOTP (基于时间的一次性密码) 技术和 RSA 加密
- **简单集成**：轻量级设计，易于设置和使用
- **高度可定制**：可配置为仅使用 FastTOTP 登录或与常规登录方式并行使用

## 功能特性

### 核心功能
- 📱 **二维码扫描登录**：生成包含安全登录信息的二维码
- 🔒 **TOTP 验证**：使用基于时间的一次性密码进行安全验证
- 🔐 **RSA 加密**：采用非对称加密保护登录流程中的敏感数据

### 安全特性
- 🛡️ **IP 阻止保护**：在多次失败登录尝试后自动阻止可疑 IP
- ⚙️ **可配置的安全设置**：允许调整最大尝试次数和阻止策略
- 🔑 **自动 RSA 密钥生成**：一键生成强加密密钥对
- 📝 **详细的错误处理**：提供清晰的错误信息和安全提示

### 灵活配置
- 🎛️ **管理面板**：直观的设置页面，便于配置插件选项
- 🔄 **双模式支持**：可选择仅使用 FastTOTP 登录或与传统登录方式并行使用
- 🌐 **多语言支持**：支持插件翻译，提供更好的国际化体验

## 安装说明

### 方法一：通过 WordPress 插件目录安装
1. 登录 WordPress 管理后台
2. 导航至 **插件** > **添加新插件**
3. 搜索 "FastTOTP"
4. 点击 "立即安装" 按钮
5. 安装完成后，点击 "激活" 按钮

### 方法二：手动安装
1. 下载插件 ZIP 文件
2. 登录 WordPress 管理后台
3. 导航至 **插件** > **添加新插件**
4. 点击 "上传插件" 按钮
5. 选择下载的 ZIP 文件并点击 "安装插件"
6. 安装完成后，点击 "激活" 按钮

### 方法三：FTP 上传
1. 解压下载的 ZIP 文件
2. 使用 FTP 客户端连接到您的网站服务器
3. 上传 `fasttotp` 文件夹到 `wp-content/plugins/` 目录
4. 登录 WordPress 管理后台
5. 导航至 **插件** 页面
6. 找到 "FastTOTP" 并点击 "激活"

## 配置指南

安装并激活插件后，请按照以下步骤进行配置：

1. 登录 WordPress 管理后台
2. 导航至 **设置** > **FastTOTP**
3. 在 "RSA 密钥设置" 部分，点击 "生成 RSA 密钥" 按钮
4. 根据您的需求配置以下选项：
   - **启用 FastTOTP**：控制是否启用 FastTOTP 登录功能
   - **仅允许 FastTOTP 登录**：选择是否禁用传统密码登录方式
   - **IP 阻止前的最大登录尝试次数**：设置允许的失败尝试次数阈值
5. 点击 "保存更改" 按钮

## 使用方法

### 用户登录流程
1. 访问您网站的登录页面 (通常是 `your-site.com/wp-login.php`)
2. 您将看到 FastTOTP 二维码登录部分
3. 使用 FastTOTP 移动应用扫描显示的二维码
4. 在移动应用中确认登录请求
5. 登录成功后，系统将自动将您重定向到 WordPress 管理后台或网站前台

### 二维码过期处理
- 每个二维码仅有效期为 5 分钟
- 页面将显示实时倒计时，提示二维码剩余有效时间
- 二维码过期后，将显示过期提示信息
- 点击 "刷新二维码" 按钮可生成新的有效二维码

## 安全说明

### 数据安全
- 登录流程使用 RSA 非对称加密保护敏感数据
- 每个登录请求生成唯一的请求 ID
- 临时数据使用 WordPress 的 transient API 存储，具有自动过期机制

### IP 阻止机制
- 插件会跟踪来自同一 IP 地址的失败登录尝试
- 当失败尝试次数超过设定阈值时，该 IP 将被临时阻止
- 阻止机制使用 WordPress transient 存储，默认阻止时间为一小时

## 技术细节

### 工作原理
1. 插件在登录页面生成包含唯一请求 ID 的二维码
2. 用户使用 FastTOTP 应用扫描二维码
3. 移动应用获取网站公钥并加密用户信息
4. 服务器接收加密数据并使用私钥解密
5. 验证 TOTP 代码是否有效
6. 验证成功后创建用户会话并完成登录

### REST API 端点
插件注册以下 REST API 端点用于登录流程：
- `/wp-json/fasttotp/v1/get_public_key` - 获取网站公钥
- `/wp-json/fasttotp/v1/submit` - 提交设备和用户信息
- `/wp-json/fasttotp/v1/verify` - 验证 TOTP 代码
- `/wp-json/fasttotp/v1/check` - 检查登录状态

## 兼容性

- **WordPress 版本**：需要 WordPress 5.8 或更高版本
- **PHP 版本**：需要 PHP 7.2 或更高版本
- **浏览器支持**：兼容所有现代浏览器 (Chrome, Firefox, Safari, Edge)
- **移动应用**：需要使用 FastTOTP 移动应用 (iOS 和 Android)

## 故障排除

### 常见问题

1. **二维码不显示**
   - 确保 FastTOTP 已在设置中启用
   - 检查 PHP 版本是否满足要求 (7.2+)
   - 清除浏览器缓存并刷新页面

2. **扫描后无法登录**
   - 确保移动设备时间与服务器时间同步
   - 检查 RSA 密钥是否正确生成
   - 验证是否超出了最大登录尝试次数限制

3. **IP 被阻止**
   - 等待一小时后重试 (默认阻止时间)
   - 可以通过 WordPress 数据库手动删除相关 transient 记录来解除阻止

## 更新日志

### 版本 1.0
- 初始发布
- 实现二维码扫描登录功能
- 添加 TOTP 验证机制
- 集成 RSA 加密保护
- 实现 IP 阻止安全功能
- 添加二维码 5 分钟有效期和倒计时显示

## 贡献指南

欢迎社区贡献！如果您想为 FastTOTP 插件做出贡献，请：

1. Fork GitHub 仓库
2. 创建您的功能分支 (`git checkout -b feature/amazing-feature`)
3. 提交您的更改 (`git commit -m 'Add some amazing feature'`)
4. 推送到分支 (`git push origin feature/amazing-feature`)
5. 开启一个 Pull Request

## 许可协议

FastTOTP 插件基于 GPLv2 或更高版本许可协议发布。详细信息请参阅 [LICENSE.txt](LICENSE.txt) 文件。

## 联系我们

- **GitHub 仓库**：https://github.com/cyobason/fasttotp
- **问题反馈**：请在 GitHub 仓库提交 Issue
- **作者**：Cyobason

---

**免责声明**：使用此插件即表示您同意遵循许可协议条款。虽然我们努力确保插件的安全性和稳定性，但对于任何因使用此插件导致的损失，作者不承担责任。

© FastTOTP. 保留所有权利。